<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="h.css">
</head>
<body>

  <div>
    <!-- 標題 -->
    <h1>Book Finder</h1>
    <!-- 搜尋表單 -->
    <form data-bookfinder-form>
      <input name="search" type="text" placeholder="請輸入搜尋內容……" />
      <button type="submit">送出</button>
    </form>
    <!-- 搜尋結果 -->
    <ul data-books></ul>
  </div>

  <script>
    // 載入 csv 檔案並解析
    let books = [];
    fetch('https://raw.githubusercontent.com/Dr-XYZ/pandas_csv/main/pandas_csv.csv')
      .then((response) => response.text())
      .then((csv) => {
        const rows = csv.trim().split('\n');
        const headers = rows.shift().split(',');
        rows.forEach((row) => {
          const values = row.split(',');
          const book = {};
          headers.forEach((header, i) => (book[header] = values[i]));
          books.push(book);
        });
        // 預設顯示所有書籍
        renderBooks(generateBookHTML(books));
      });

    // 生成 HTML
    function generateBookHTML(targetBooks) {
      return targetBooks
        .map(
          (book) =>
            ` <a href="${book['影片連結']}" class="container" target="_blank"><div class="text"><h2>${book['標題']}</h2><p>${book['標籤']}</p></div><span class="box"> <img src="https://img.youtube.com/vi/30TBORWsGpw/sddefault.jpg" > </span>  </a>`
        )

    //    




        .join('');
    }

    // 渲染到畫面上
    function renderBooks(targetHTML) {
      const bookList = document.querySelector('[data-books]');
      bookList.innerHTML = targetHTML;
    }

    // 過濾函式
    function booksFilter(targetBook, allBooks = books) {
      if (targetBook.trim() === '') {
        return allBooks;
      }
      return allBooks.filter((book) => {
        return book['標題'].includes(targetBook);
      });
    }

    // 監聽表單
    document.querySelector('[data-bookfinder-form]').addEventListener('submit', (e) => {
      e.preventDefault();
      renderBooks(generateBookHTML(booksFilter(e.target.search.value)));
    });
  </script>

</body>
</html>
